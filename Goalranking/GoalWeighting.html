{{ block title }}
    Goal weighting
{{ endblock }}


{{ block content }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>

    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            border: 0;
        }
        td {
            width: calc(100% / 8);
            border: 0;
            text-align: center;
        }

        table {
            width: 100%;
            border: 0;
            border-collapse: collapse;
        }
        td {
            width: calc(100% / 8);
            border: 0;
            text-align: center;
        }
    </style>

    <p> Please rate how important the following goals are to you.
        There are up to 18 points to allocate.
        Objectives cannot be rated with more than 5 points.</p>
    <p> We would also like to ask you to select the goal which is the most important to you.<p>

    TODO: add sixth goal to point allocation and spidergraph
    TODO: add Checkbox for the most important goal




    <!-- TODO: Replace the table with div -->
    <table>
        <tr>
            <td>
                <!-- Slider for goals-->
               <u><b>Sum</b></u>: <p id="total_value"></p><br>


                <!-- first goal -->
                <input type="checkbox" id="choice_one" onclick="handleCheckbox(this)">  {{first_goal}}:  <span id="first_goal_rank_value">1</span> <br>
                <input type="range" name="first_goal_rank" min="1" max="5" value="1" oninput="updateDescription(this)">
                <br><br>

                <input type="checkbox" id="choice_two" onclick="handleCheckbox(this)"> {{second_goal}}:  <span id="second_goal_rank_value">1</span><br>
                <input type="range" name="second_goal_rank" min="1" max="5" value="1" oninput="updateDescription(this)">
                <br><br>

                <br><input type="checkbox" id="choice_three" onclick="handleCheckbox(this)">  {{third_goal}}:  <span id="third_goal_rank_value">1</span><br>
                <input type="range" name="third_goal_rank" min="1" max="5" value="1" oninput="updateDescription(this)">
                <br><br>

                <br><input type="checkbox" id="choice_four" onclick="handleCheckbox(this)">  {{fourth_goal}}:  <span id="fourth_goal_rank_value">1</span><br>
                <input type="range" name="fourth_goal_rank" min="1" max="5" value="1" oninput="updateDescription(this)">
                <br><br>

                <input type="checkbox" id="choice_five" onclick="handleCheckbox(this)">  {{fifth_goal}}:  <span id="fifth_goal_rank_value">1</span><br>
                <input type="range" name="fifth_goal_rank" min="1" max="5" value="1" oninput="updateDescription(this)">
                <br><br>

                <input type="checkbox" id="choice_six" onclick="handleCheckbox(this)">  {{sixth_goal}}:  <span id="sixth_goal_rank_value">1</span><br>
                <input type="range" name="sixth_goal_rank" min="1" max="5" value="1" oninput="updateDescription(this)">
                <br><br>




            </td>
            <td>
                 <!-- Container für den RadarChart -->
                <div id="radarChartContainer" style="max-width: 50%; width: 400px;">
                    <!-- Canvas für den RadarChart -->
                    <canvas id="myRadarChart" width="400" height="400"></canvas>
                </div>
            </td>
        </tr>
    </table>


    <br>


    <!-- Skript für die Aktualisierung der Gesamtsumme und das Erstellen des RadarCharts -->
    <script>
        // function to handle the checkboxes
        function handleCheckbox(clickedCheckbox) {
            const checkboxes = ["choice_one", "choice_two", "choice_three", "choice_four", "choice_five", "choice_six"];
            // make sure, that there is just one checkbox selected
            checkboxes.forEach(id => {
                if (id !== clickedCheckbox.id) {
                    document.getElementById(id).checked = false;
                }
            });
            // send checkbox information zu otree
            if (clickedCheckbox.id === "choice_one") {
                liveSend({'information': js_vars.first_goal_js});
            } else if (clickedCheckbox.id === "choice_two") {
                liveSend({'information': js_vars.second_goal_js});
            } else if (clickedCheckbox.id === "choice_three") {
                liveSend({'information': js_vars.third_goal_js});
            } else if (clickedCheckbox.id === "choice_four") {
                liveSend({'information': js_vars.fourth_goal_js});
            } else if (clickedCheckbox.id === "choice_five") {
                liveSend({'information': js_vars.fifth_goal_js});
            } else if (clickedCheckbox.id === "choice_six") {
                liveSend({'information': js_vars.sixth_goal_js});
            }
        }

        // Funktion zur Aktualisierung der Beschreibung und zum Erstellen des RadarCharts
        function updateDescription(input) {
            let value = parseInt(input.value);
            let spanId = input.name + "_value";
            document.getElementById(spanId).innerText = value;

            let total = 0;
            let sliders = document.querySelectorAll('input[type="range"]');
            sliders.forEach(slider => {
                total += parseInt(slider.value);
            });

            document.getElementById('total_value').innerText = `${total}`;

            // Aufrufen der Funktion zur Radarcharterstellung
            createRadarChart(total);
        }

        // Funktion zum Erstellen des RadarCharts
        function createRadarChart(total) {
            let ctx = document.getElementById('myRadarChart').getContext('2d');
            let myRadarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: [js_vars.first_goal_js, js_vars.second_goal_js, js_vars.third_goal_js,
                             js_vars.fourth_goal_js, js_vars.fifth_goal_js, js_vars.sixth_goal_js],
                    datasets: [{
                        label: 'Goals',
                        data: [
                               parseInt(document.querySelector('input[name="first_goal_rank"]').value),
                               parseInt(document.querySelector('input[name="second_goal_rank"]').value),
                               parseInt(document.querySelector('input[name="third_goal_rank"]').value),
                               parseInt(document.querySelector('input[name="fourth_goal_rank"]').value),
                               parseInt(document.querySelector('input[name="fifth_goal_rank"]').value),
                               parseInt(document.querySelector('input[name="sixth_goal_rank"]').value)
                               ],
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    scale: {
                        ticks: {
                            beginAtZero: true,
                            max: 5
                        }
                    }
                }
            });
        }

        // Initiales Erstellen des RadarCharts
        createRadarChart(5);
    </script>

    <br>

    {{ next_button }}


{{ endblock }}


